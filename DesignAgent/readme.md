# ğŸ“– æ™ºèƒ½ä½“ç®€ä»‹
  æœ¬æ™ºèƒ½ä½“ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®å·¥ç¨‹å¾®ç”Ÿç‰©è¯†åˆ«æ™ºèƒ½ä½“çš„è¯†åˆ«ç»“æœå’Œç”¨æˆ·è¾“å…¥çš„æ°´è´¨å‚æ•°ï¼ˆæ¸©åº¦ã€pHã€ç›åº¦å’Œå¥½æ°§/ç¼ºæ°§/åŒæ°§ï¼‰è¿›è¡ŒèŒå‰‚çš„è®¾è®¡ï¼Œæœ€åè¾“å‡ºå‡ºæœ€ä½³çš„è®¾è®¡ç»“æœã€‚
---
# ğŸ“ƒ å‡†å¤‡æ–‡ä»¶
  - Sheet1_Complementarity.xlsx : å€™é€‰åå•é‡Œç‰©ç§ä¹‹å‰çš„ä»£è°¢äº’è¡¥æŒ‡æ•°å’Œä»£è°¢ç«äº‰æŒ‡æ•°
  - Sheet2_Species_environment.xlsxï¼šTool_GenomeSPOT è®¡ç®—æ‰€å¾—å¾®ç”Ÿç‰©ç”Ÿå¢ƒæ¡ä»¶
  - Sheet3_Function_enzyme_kact.xlsx: Tool_DLkcat è®¡ç®—æ‰€å¾—é…¶é™è§£é€Ÿç‡
  - Sheet4_species_enzyme.xlsxï¼šé™è§£åŠŸèƒ½å¾®ç”Ÿç‰©åŒ…å«çš„é™è§£é…¶çš„ç§ç±»
  - Sheet5 Sheet5_PhyloMInt.csvï¼š å¾®ç”Ÿç‰©æ•°æ®åº“æ€»çš„PhyloMIntè¡¨
---
# ğŸš€ è®¡ç®—è¿‡ç¨‹
**Step 1 è¿è¡ŒDesign_pipeline_1.py**
---
  ## å·¥ä½œå†…å®¹
  `Design_pipline_1.py` ä¸»è¦å®Œæˆ 3 ä»¶äº‹ï¼š
  1. **åŠŸèƒ½èŒå€™é€‰ç­›é€‰**ï¼šæŒ‰ç›®æ ‡å·¥å†µï¼ˆæ¸©åº¦ã€pHã€ç›åº¦ã€æ°§ç¯å¢ƒï¼‰ç­›é€‰æ»¡è¶³æ¡ä»¶çš„åŠŸèƒ½èŒï¼Œå¹¶æ±‡æ€»æ¯ä¸ªèŒçš„ `kcat_max / kcat_mean`ï¼›  
  2. **å•èŒç»¼åˆæ‰“åˆ†ï¼ˆS_microbeï¼‰**ï¼šå¯¹åŠŸèƒ½èŒä¸é€šè¿‡ç¯å¢ƒç­›é€‰çš„äº’è¡¥èŒè®¡ç®—å•èŒå¾—åˆ†ï¼Œè¾“å‡ºåˆ° `Result2_candidate_scores.csv`ï¼›  
  3. **ä¸¤ä¸¤äº’ä½œçŸ©é˜µ**ï¼šèåˆ Sheet1ï¼ˆä¸“å®¶/å®éªŒçŸ¥è¯†ï¼‰ä¸ PhyloMintï¼ˆåŸºå› ç»„è·ç¦»æ¨æ–­ï¼‰ç”Ÿæˆ `(competition, complementarity, delta)` æŒ‡æ ‡ï¼Œè¾“å‡ºåˆ° `Result3_pair_Com_index.csv`ã€‚
---
  ## ğŸ§­ è¿è¡Œæ–¹å¼
  è„šæœ¬ä»¥**äº¤äº’å¼**æ–¹å¼è·å–ç›®æ ‡å·¥å†µï¼š
  ```text
  ç›®æ ‡æ¸©åº¦ (Â°C)ï¼š
  ç›®æ ‡ pHï¼š
  ç›®æ ‡ç›åº¦ï¼ˆ% NaClï¼‰ï¼š
  æ°§ç¯å¢ƒï¼ˆå¥½æ°§ / åŒæ°§ / ç¼ºæ°§ï¼‰ï¼š
  ```
  - æ°§ç¯å¢ƒä¼šè‡ªåŠ¨æ˜ å°„ä¸ºï¼šå¥½æ°§ â†’ `tolerant`ï¼›åŒæ°§/ç¼ºæ°§ â†’ `not tolerant`ã€‚
---
## **åŠŸèƒ½èŒå€™é€‰ç­›é€‰**
æ ¹æ®è¾“å…¥çš„ç›®æ ‡å·¥å†µï¼ŒåŒ¹é…é€‚åº”çš„åŠŸèƒ½å¾®ç”Ÿç‰©å’Œäº’è¡¥å¾®ç”Ÿç‰©ï¼Œå¹¶æ±‡æ€»åŒ¹é…ç‰©ç§ã€å«æœ‰é…¶ç§ç±»ã€é…¶é™è§£é€Ÿç‡ç­‰ä¿¡æ¯ï¼Œè¾“å…¥è¡¨Result1_candidate_function_species.csv
---
## **å•èŒç»¼åˆæ‰“åˆ†ï¼ˆS_microbeï¼‰**
æ ¹æ®è®¡ç®—å…¬å¼å¯¹å•èŒè¿›è¡Œç¯å¢ƒé€‚åº”åº¦å’Œé™è§£åŠŸèƒ½èƒ½åŠ›æ–¹é¢çš„ç»¼åˆæ‰“åˆ†ï¼Œæ‰“åˆ†è®¡ç®—å…¬å¼ä¸ºï¼š
```
S_microbe
= 0.5 * Norm01(kcat_max)
+ 0.4 * env_soft_score
+ 0.1 * Norm01(enzyme_diversity)
```
- `Norm01` ä¸ºåˆ—å†… minâ€“max å½’ä¸€åŒ–ï¼ˆæ•´åˆ—å¸¸æ•°â†’1ï¼‰ï¼›kcat_max æ˜¯æ‰€å«é™è§£é…¶æœ€å¤§é™è§£é€Ÿç‡ã€‚
- `env_soft_score` æ˜¯è¯¥ç‰©ç§çš„ç¯å¢ƒè¯„åˆ†å…·ä½“ä¸‹ä¸‹ä¸€å°èŠ‚ã€‚
- `enzyme_diversity` æ¥è‡ª `Sheet4` ä¸­è¯¥ç‰©ç§çš„é…¶ååˆ—è¡¨é•¿åº¦ã€‚

è¾“å‡ºåˆ—ï¼ˆèŠ‚é€‰ï¼‰ï¼š
- `species, kcat_max, kcat_mean, enzyme_diversity, environment_match(=env_soft_score), source, S_microbe`
---

## ğŸ§  è½¯ç¯å¢ƒåŒ¹é…è¯„åˆ†ï¼ˆ0~1ï¼‰
- **æ¸©åº¦/ pH**ï¼šåŒºé—´å†…æŒ‰â€œ**ä¸‰è§’éš¶å±**â€éšåç¦»æœ€é€‚ç‚¹çº¿æ€§ä¸‹é™ï¼›è¶…å‡ºåŒºé—´æŒ‰â€œ**æŒ‡æ•°è¡°å‡**â€é™åˆ†ï¼›
- **ç›åº¦**ï¼šä¸è¶…è¿‡ä¸Šé™è®° 1ï¼›è¶…å‡ºä¸Šé™æŒ‰â€œ**æŒ‡æ•°è¡°å‡**â€ï¼›
- **æ°§æ°”**ï¼šåŒ¹é…=1.0ï¼ŒæœªçŸ¥=0.5ï¼Œä¸åŒ¹é…=0.2ï¼›
- è‡ªåŠ¨å¿½ç•¥ç¼ºå¤±é¡¹å¹¶**é‡å½’ä¸€åŒ–æƒé‡**ã€‚

é»˜è®¤æƒé‡ï¼ˆå¯åœ¨å‡½æ•° `soft_env_score_row` ä¸­æ”¹ï¼‰ï¼š
- æ¸©åº¦ `wT=0.35`ã€pH `wPH=0.35`ã€ç›åº¦ `wS=0.10`ã€æ°§æ°” `wO2=0.20`ã€‚

**ç»“æœåˆ—ï¼š**
- `env_match_all`ï¼šå¸ƒå°”å‹ï¼Œæ˜¯å¦åŒæ—¶æ»¡è¶³å››é¡¹ç¡¬æ¡ä»¶ï¼›
- `env_soft_score`ï¼š0~1 çš„è½¯åŒ¹é…åˆ†ï¼ˆç”¨äºåç»­ `S_microbe` çš„ç¯å¢ƒåˆ†é‡ï¼‰ã€‚

---

## ğŸ§ª åŠŸèƒ½èŒå€™é€‰ä¸ Kcat æ±‡æ€»
- ä» `Sheet4_species_enzyme.xlsx` è·å–ç‰©ç§-é…¶æ˜ å°„ï¼›
- åœ¨ `Sheet3_Function_enzyme_kact.xlsx` ä¸­æŒ‰é…¶åèšåˆå…¶ `Kcat value (1/s)` çš„**ä¸­ä½æ•°**ï¼›
- æ¯ä¸ªç‰©ç§ï¼š`kcat_max` = å…¶é…¶çš„ Kcat ä¸­ä½æ•°æœ€å¤§å€¼ï¼›`kcat_mean` = å…¶é…¶çš„ Kcat ä¸­ä½æ•°çš„å¹³å‡ï¼›
- ä½¿ç”¨ç›®æ ‡å·¥å†µç­›æ‰ `env_match_all=False` çš„åŠŸèƒ½èŒï¼›ä¿ç•™çš„å€™é€‰è¡¨æŒ‰ `kcat_max` é™åºè¾“å‡ºï¼š  
  **`Result1_candidate_function_species.csv`**ï¼ˆè„šæœ¬é‡Œå¸¸é‡ `OUTPUT_PATH`ï¼‰ã€‚

å€™é€‰è¡¨é™„å¸¦äº’è¡¥èŒé€šè¿‡/å¤±è´¥ç»Ÿè®¡ï¼š
- `complement_total / complement_pass / complement_fail`ï¼›
- `complement_pass_names / complement_fail_names`ï¼ˆä»¥ `;` åˆ†éš”ï¼‰ã€‚

---

## ğŸ”¢ å•èŒç»¼åˆæ‰“åˆ† S_microbe
å¯¹ **åŠŸèƒ½èŒ + é€šè¿‡è½¯è¯„åˆ†çš„äº’è¡¥èŒ** è¾“å‡º `Result2_candidate_scores.csv`ã€‚è¯„åˆ†æ„æˆï¼š
```
S_microbe
= 0.5 * Norm01(kcat_max)
+ 0.4 * env_soft_score
+ 0.1 * Norm01(enzyme_diversity)
```
- `Norm01` ä¸ºåˆ—å†… minâ€“max å½’ä¸€åŒ–ï¼ˆæ•´åˆ—å¸¸æ•°â†’1ï¼‰ï¼›
- `enzyme_diversity` æ¥è‡ª `Sheet4` ä¸­è¯¥ç‰©ç§çš„é…¶ååˆ—è¡¨é•¿åº¦ã€‚

è¾“å‡ºåˆ—ï¼ˆèŠ‚é€‰ï¼‰ï¼š
- `species, kcat_max, kcat_mean, enzyme_diversity, environment_match(=env_soft_score), source, S_microbe`

---

## ğŸ” ä¸¤ä¸¤äº’ä½œçŸ©é˜µï¼ˆSheet1 + PhyloMintï¼‰
- è‹¥ `(åŠŸèƒ½èŒ, å¯¹åº”äº’è¡¥èŒ)` åœ¨ **Sheet1** ä¸­æ‰¾åˆ°ï¼Œåˆ™**ä¼˜å…ˆ**ä½¿ç”¨ Sheet1 çš„ `competition, complementarity, delta`ï¼›
- å¦åˆ™å°è¯•åœ¨ **PhyloMint** ä¸­ç”¨åŸºå› ç»„é…å¯¹çš„å¹³å‡å€¼ï¼›
- ç»“æœå¯¹ç§°è¡¥é½ï¼ˆä¾¿äºä»»æ„æ–¹å‘æ£€ç´¢ï¼‰ï¼›è¾“å‡ºåˆ°ï¼š  
  **`Result3_pair_Com_index.csv`**ã€‚

ä¸»è¦åˆ—ï¼š
- `functional_species, complement_species, competition_index, complementarity_index, delta_index, source`

---

## ğŸ“¤ è„šæœ¬è¾“å‡ºä¸€è§ˆ
- `Result1_candidate_function_species.csv`ï¼šæ»¡è¶³ç›®æ ‡å·¥å†µçš„åŠŸèƒ½èŒå€™é€‰ï¼ˆå« `kcat_*` ä¸äº’è¡¥èŒç»Ÿè®¡ï¼‰ï¼›
- `Result2_candidate_scores.csv`ï¼šåŠŸèƒ½èŒ+äº’è¡¥èŒçš„å•èŒç»¼åˆæ‰“åˆ†ï¼›
- `Result3_pair_Com_index.csv`ï¼šä¸¤ä¸¤äº’ä½œçŸ©é˜µï¼ˆèåˆ Sheet1 ä¸ PhyloMintï¼‰ã€‚

---

## ğŸ§° å¸¸è§é—®é¢˜
- **åˆ—åä¸åŒ¹é…**ï¼šè„šæœ¬å¯¹å››å¼ è¡¨çš„åˆ—å/å·¥ä½œè¡¨åæœ‰å‡è®¾ï¼Œè‹¥ä¸ä½ çš„æ•°æ®ä¸åŒï¼Œè¯·åœ¨â€œå›ºå®šåˆ—æ˜ å°„â€éƒ¨åˆ†è°ƒæ•´ã€‚  
- **ç¯å¢ƒå­—æ®µç¼ºå¤±**ï¼šè½¯è¯„åˆ†ä¼šè‡ªåŠ¨ç•¥è¿‡ç¼ºå¤±ç»´åº¦å¹¶é‡å½’ä¸€åŒ–ï¼›ä½† `env_match_all` çš„ç¡¬æ¡ä»¶éœ€è¦å­—æ®µå®Œæ•´æ‰ä¼šä¸¥æ ¼åˆ¤å®šã€‚  
- **PhyloMint ç¼ºå¤±**ï¼šè„šæœ¬ä¼šæç¤ºå¹¶ä»…ç”¨ Sheet1 çš„é…å¯¹å…³ç³»ç”ŸæˆçŸ©é˜µã€‚
---

# ğŸš€ è®¡ç®—è¿‡ç¨‹
**Step 2 è¿è¡ŒDesign_pipeline_2.py**
---
## ğŸ“Œ å·¥å…·ç®€ä»‹
- ç›®æ ‡ï¼šåœ¨ç»™å®šå€™é€‰ç‰©ç§é›†åˆä¸ä¸¤ä¸¤äº’ä½œæŒ‡æ ‡çš„åŸºç¡€ä¸Šï¼Œæœç´¢å¾—åˆ°**ç»¼åˆå¾—åˆ†æœ€é«˜**çš„èŒç¾¤ç»„åˆã€‚
- è¯„åˆ†è€ƒè™‘ï¼šå•èŒæ‰“åˆ†ã€ä¸¤ä¸¤äº’ä½œï¼ˆå¢ç›Šä¸ç«äº‰ï¼‰ã€æˆå‘˜å¹³å‡ `kcat_max`ã€ç»„åˆè§„æ¨¡æƒ©ç½šã€‚

---
## ğŸ“¥ è¾“å…¥æ–‡ä»¶æ ¼å¼
ä»¥pipeline1è¾“å‡ºçš„ç»“æœè¡¨Result2_candidate_scores.csvå’ŒResult3_pair_Com_index.csvä¸ºè¾“å…¥ã€‚

## ğŸ§® ç›®æ ‡å‡½æ•°ï¼ˆç»„åˆå¾—åˆ†ï¼‰

å¯¹æˆå‘˜é›†åˆ $M$ï¼ˆè§„æ¨¡ $|M|=N$ï¼‰çš„æœ€ç»ˆå¾—åˆ†ï¼š

$$
S_{\text{consort}}
= \alpha\, \overline{S_{\text{microbe}}}
+ \beta\, \overline{\Delta^+}
- \gamma\, \overline{\mathrm{Comp}^+}
+ \lambda\, \overline{\mathrm{kcat}}
- \mu\, N
$$

- $\overline{S_{\text{microbe}}}$ï¼šæˆå‘˜åœ¨ `scores` è¡¨ä¸­ `S_microbe` çš„**ç®—æœ¯å¹³å‡**ã€‚
- $\overline{\Delta^+}$ï¼šæˆå‘˜ä¸¤ä¸¤ `delta_index` ä¸­ **>0** çš„å¹³å‡ã€‚
- $\overline{\mathrm{Comp}^+}$ï¼šæˆå‘˜ä¸¤ä¸¤ `competition_index` ä¸­ **>0** çš„å¹³å‡ï¼ˆæƒ©ç½šé¡¹ï¼‰ã€‚
- $\overline{\mathrm{kcat}}$ï¼ˆå³ `avg_kcat`ï¼‰ï¼šæˆå‘˜åœ¨ `scores` è¡¨ä¸­ `kcat_max` çš„**ç®—æœ¯å¹³å‡**ï¼ˆç¼ºå¤±çš„æˆå‘˜å°†è¢«å¿½ç•¥äºå¹³å‡ï¼‰ã€‚
- $N$ï¼šç»„åˆè§„æ¨¡ï¼ˆæˆå‘˜æ•°ï¼‰ã€‚



---

## âš™ï¸ å‘½ä»¤è¡Œå‚æ•°ä¸é»˜è®¤å€¼

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | å¿…å¡« |
|---|---|---|:---:|
| `--scores` | `Result2_candidate_scores.csv` è·¯å¾„ | æ—  | âœ… |
| `--pairs` | `Result3_pair_Com_index.csv` è·¯å¾„ | æ—  | âœ… |
| `--out` | æœ€ä¼˜ç»„åˆè¾“å‡º | `Result4_optimal_consortia.csv` |  |
| `--members_out` | æˆå‘˜è´¡çŒ®æ’åè¾“å‡º | `Result4_members_rank.csv` |  |
| `--topN` | å…ˆæŒ‰ `S_microbe` å–å‰ N ä¸ªå…¥æœç´¢æ±  | `50` |  |
| `--kmin` / `--kmax` | ç»„åˆæœ€å°/æœ€å¤§è§„æ¨¡ | `2` / `5` |  |
| `--mode` | `greedy` æˆ– `exhaustive` | `greedy` |  |
| `--topK` | è¾“å‡ºå‰ K ä¸ªæœ€ä¼˜ç»„åˆ | `20` |  |
| `--require_functional` | æ˜¯å¦è¦æ±‚å«è‡³å°‘ 1 ä¸ªåŠŸèƒ½èŒï¼ˆ1/0ï¼‰ | `1` |  |
| `--alpha` | æƒé‡ï¼šå¹³å‡ `S_microbe` | `0.2` |  |
| `--beta` | æƒé‡ï¼šå¹³å‡æ­£ `delta_index` | `0.2` |  |
| `--gamma` | æƒé‡ï¼šå¹³å‡æ­£ `competition_index`ï¼ˆæƒ©ç½šï¼‰ | `0.1` |  |
| `--lambda_` | æƒé‡ï¼šå¹³å‡ `kcat_max`ï¼ˆåŠ åˆ†ï¼‰ | `0.35` |  |
| `--mu` | æƒé‡ï¼šè§„æ¨¡æƒ©ç½š | `-0.05` |  |

---

## ğŸš€ è¿è¡Œç¤ºä¾‹

### 1) è´ªå¿ƒæœç´¢ï¼ˆæ¨èå¿«é€Ÿè¯•è·‘ï¼‰
```bash
python Design_pipeline_2.py   --scores ./Result2_candidate_scores.csv   --pairs  ./Result3_pair_Com_index.csv   --kmin 2 --kmax 6 --mode greedy --topK 30
```

### 2) ç©·ä¸¾æœç´¢ï¼ˆå°è§„æ¨¡/ä¸¥æ ¼ï¼‰
```bash
python Design_pipeline_2.py   --scores ./Result2_candidate_scores.csv   --pairs  ./Result3_pair_Com_index.csv   --topN 30 --kmin 2 --kmax 4 --mode exhaustive --topK 50
```



